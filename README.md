# fusepy_vulnerability_experiment

I'm anticipating some aprehension about using fuse at work since it's possible to write a virtual filesystem for FUSE (fusermount runs suid root) where the UIDs, GIDs, and permission bits shown to people using the virtual filesystem can be set to root, root, SUID respectively. Some may think this means that one could write a malicious program to gain root privileges when executed through the virtual filesystem. FUSE has you covered though. Try the following:


 
```bash
https://github.com/pistoletpierre/fusepy_vulnerability_experiment
cd fusepy_vulnerability_experiment
gcc -o getuid getuid.c
sudo chown root getuid
chmod 4755 getuid
ls -al getuid # note the SUID bit
./getuid
```

See EFFECTIVE UID 0? That's root, and that makes sense because we changed the owner of ./getuid to root and set the SUID bit
Now let's set the owner back to our own username and get rid of the SUID bit:

```bash
sudo chown $(whoami) getuid
chmod 755 getuid
ls -al getuid # note the owner and permission bits now
```

Now let's make a virtual filesystem that passes our potentially malicious binary through but presents different owners & permission bits

```bash
mkdir -p mountpoint_parent/mountpoint
pip install fusepy
python fuse_passthrough.py . mountpoint_parent/mountpoint
```

Then in another terminal:

```bash
# cd to the dir where this repo clone is
ls -al mountpoint_parent/mountpoint # note everything being "owned" by root with setuid bits set

#total 44
#drwsr-xr-x 6 root  staff   192 Aug 27 21:33 ./
#drwxr-xr-x 3 me    staff    96 Aug 27 21:33 ../
#-rwSr--r-- 1 root  staff 12882 Aug 27 21:30 fusepy_passthrough.py
#drwsr-xr-x 3 root  staff    96 Aug 27 21:33 mountpoint_parent/
#-rwsr-xr-x 1 root  staff 12652 Aug 27 21:23 setuid*
#-rwSr--r-- 1 root  staff   188 Aug 27 21:22 setuid.c

# run our 'malicious' program
mountpoint_parent/mountpoint/getuid
# Output
# The REAL UID =: <your UID>
# The EFFECTIVE UID =: <your UID>

# note the effective UID and the REAL UID are the same, and neither is root (unless you are indeed root at the time of execution)
```
